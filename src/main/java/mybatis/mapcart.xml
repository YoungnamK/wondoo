<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="NsCart">
	<sql id="basic_select">
		select * from cart
	</sql>
	
	<!-- 장바구니 추가 -->
	<insert id="InsertData" parameterType="MyCart">
		insert into 
		cart(
		cart_seq, 
		cart_pro_no, 
		cart_cust_qty, 
		cart_cust_email, 
		cart_price)
		values(
		cart_seq.nextval, 
		#{cart_pro_no}, 
		#{cart_cust_qty}, 
		#{cart_cust_email}, 
		#{cart_price})
	</insert>
	
	<!-- 장바구니 목록 보기  -->
	<select id="SelectAllData" parameterType="String" resultType="MyCart">
		<include refid="basic_select"/>
		where cart_cust_email=#{cart_cust_email}
	</select>
	
	<!-- 장바구니 삭제 하기 -->
	<delete id="DeleteData" parameterType="Integer">
		delete from cart 
		where cart_seq=#{cart_seq}
	</delete>
	
	<!-- 장바구니 상품번호 중복 체크 -->
	<select id="DuplProNoCheck" parameterType="Integer" resultType="Integer">
		select count(*) from cart
		where cart_pro_no=#{cart_pro_no}
	</select>
	
	<!-- 장바구니 상품번호 중복 체크 후 기존에 들어있던 상품이면 수량 , 가격을 누적한다.-->
	<update id="UpdateQtyPrice" parameterType="MyCart">
		update cart set cart_cust_qty = cart_cust_qty  <![CDATA[+]]> #{cart_cust_qty} , 
		cart_price = cart_price <![CDATA[+]]> #{cart_price}
		where cart_pro_no=#{cart_pro_no}
	</update>
	
	<!-- 상품 수량 , 가격을 누적하기 전 재고량을 파악해야함 -->
	<select id="SelectByQty" parameterType="Integer" resultType="Integer">
		select sum(cart_cust_qty) from cart
		where cart_pro_no=#{cart_pro_no}
	</select>
</mapper>